{%- render 'section-spacing-collapsing' -%}

<style>
  /* Toujours afficher la variante mobile (horizontal scroll) sur desktop */
  #shopify-section-{{ section.id }} .images-scrolling-desktop {
    display: none !important;
  }
  #shopify-section-{{ section.id }} {
    /* forcer le défilement horizontal sur toutes les tailles */
    --images-scrolling-grid: auto / auto-flow 73vw;
  }
  /* conserver l'empilement si demandé */
  @media screen and (max-width: 740px) {
    #shopify-section-{{ section.id }} {
      --images-scrolling-grid: {% if section.settings.stack_on_mobile %}none{% else %}auto / auto-flow 73vw{% endif %};
    }
  }
</style>

<div {% render 'section-properties', narrow: true %}>
  <images-with-text-scrolling class="images-scrolling-mobile scroll-area bleed sm:unbleed">
    {%- for block in section.blocks -%}
      <div class="images-scrolling-mobile__item snap-start" {{ block.shopify_attributes }}>
        {%- if block.settings.image != blank -%}
          {{- block.settings.image
              | image_url: width: block.settings.image.width
              | image_tag: loading: 'lazy',
                          sizes: '100vw',
                          widths: '200,400,600,800,1000,1200,1400,1600',
                          class: 'rounded-lg'
          -}}
        {%- endif -%}

        <div class="images-scrolling__content">
          <div class="prose" style="--images-scrolling-item-icon-width: {{ block.settings.icon_width }}px; text-align: center;">
            {%- if block.settings.custom_icon != blank -%}
              {%- capture sizes -%}{{ block.settings.icon_width }}px{%- endcapture -%}
              {%- capture widths -%}{{ block.settings.icon_width }}, {{ block.settings.icon_width | times: 2 | at_most: block.settings.custom_icon.width }}{%- endcapture -%}
              {{- block.settings.custom_icon
                  | image_url: width: block.settings.custom_icon.width
                  | image_tag: loading: 'lazy', sizes: sizes, widths: widths, class: 'images-scrolling__icon'
              -}}
            {%- elsif block.settings.icon != 'none' -%}
              {%- render 'icon' with block.settings.icon, width: block.settings.icon_width, height: block.settings.icon_width, class: 'images-scrolling__icon' -%}
            {%- endif -%}

            {%- if block.settings.title != blank -%}
              <p class="h3" {% if settings.heading_apparition != 'none' %}reveal-on-scroll="true"{% endif %}>
                {%- render 'styled-text', content: block.settings.title, text_color: section.settings.heading_color, gradient: section.settings.heading_gradient, apparition_effect: true -%}
              </p>
            {%- endif -%}

            {{- block.settings.content -}}
          </div>
        </div>
      </div>
    {%- endfor -%}
  </images-with-text-scrolling>
</div>

{% schema %}
{
  "name": "Images and text scrolling",
  "tag": "section",
  "class": "shopify-section--images-and-text-scrolling",
  "disabled_on": { "templates": ["password"], "groups": ["header","custom.overlay"] },
  "max_blocks": 15,
  "settings": [
    {"type":"checkbox","id":"full_width","label":"Full width","default":true},
    {"type":"checkbox","id":"stack_on_mobile","label":"Stack on mobile","default":false},
    {"type":"checkbox","id":"show_counter","label":"Show counter","default":true},
    {"type":"select","id":"desktop_image_effect","label":"Desktop image transition","options":[{"value":"reveal","label":"Reveal"},{"value":"fade","label":"Fade"}],"default":"reveal"},
    {"type":"select","id":"image_position","label":"Image position","options":[{"value":"start","label":"Left"},{"value":"end","label":"Right"}],"default":"end"},
    {"type":"header","content":"Colors","info":"Gradient replaces solid colors when set."},
    {"type":"color","id":"background","label":"Background"},
    {"type":"color_background","id":"background_gradient","label":"Background gradient"},
    {"type":"color","id":"text_color","label":"Text"},
    {"type":"color","id":"heading_color","label":"Heading color"},
    {"type":"color_background","id":"heading_gradient","label":"Heading gradient"}
  ],
  "blocks":[
    {"type":"item","name":"Item","settings":[
      {"type":"image_picker","id":"image","label":"Image","info":"1200 x 1600px .jpg recommended"},
      {"type":"select","id":"icon","label":"Icon","options":[{"value":"none","label":"None"}, {"value":"picto-coupon","label":"Coupon","group":"Shop"}, {"value":"picto-percent","label":"Percent","group":"Shop"}, {"value":"picto-gift","label":"Gift","group":"Shop"}],"default":"none"},
      {"type":"image_picker","id":"custom_icon","label":"Custom icon","info":"240 x 240px .png recommended"},
      {"type":"range","id":"icon_width","min":24,"max":120,"step":4,"unit":"px","label":"Icon width","default":48},
      {"type":"text","id":"title","label":"Heading","default":"Heading"},
      {"type":"richtext","id":"content","label":"Content","default":"<p>Use this text to share information about your brand with your customers.</p>"}
    ]}
  ],
  "presets":[{"name":"Images and text scrolling","blocks":[{"type":"item","settings":{"title":"Heading 1"}},{"type":"item","settings":{"title":"Heading 2"}}]}]
}
{% endschema %}
